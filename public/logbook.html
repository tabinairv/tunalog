<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logbook Form</title>
    <link rel="stylesheet" href="css/form-2.css">     
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"> 
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />        
</head>

<body>
    <div class="sidebar">
        <div class="logo">
            <img src="img/logo.png" alt="Logo">
            <h2>TunaLog.</h2>
        </div>
        <div class="menu">         
            <a href="dashboard.html"><i class="fas fa-home"></i><span>Dashboard</span></a>
            <a href="pelabuhan.html"><i class="fas fa-building"></i><span>Pelabuhan</span></a>
            <a href="logbook.html"class="active"><i class="fas fa-clipboard-check"></i><span>Report</span></a>           
            <a href="rfmo.html" ><i class="fas fa-globe"></i><span>RFMO</span></a>               
            <a href="realtime.html"><i class="fas fa-business-time"></i><span>Real time</span></a>       
        </div>
    </div>
    <div class="main-content">            
        <div class="dashboard">            
            <div class="form-container">
                <h2>Logbook Penangkapan Ikan</h2>           
                <form id="logbookForm" onsubmit="return false;">
                    <div class="container">
                        <div class="grid">
                            <div>
                                <label for="namaKapal">Nama Kapal<span class="required">*</span></label>
                                <input type="text" id="namaKapal" name="namaKapal">
                            </div>
                            <div>
                                <label for="namaPemilik">Nama Pemilik Kapal<span class="required">*</span></label>
                                <input type="text" id="namaPemilik" name="namaPemilik">
                            </div>
                            <div>
                                <label for="nomorPerizinan">Nomor Perizinan Berusaha<span class="required">*</span></label>
                                <input type="text" id="nomorPerizinan" name="nomorPerizinan">
                            </div>
                            <div>
                                <label for="transmiterSPKP">Transmiter SPKP</label>
                                <input type="text" id="transmiterSPKP" name="transmiterSPKP">
                            </div>
                            <div>
                                <label for="tripKe">Trip Ke-</label>
                                <input type="number" id="tripKe" name="tripKe">
                                <small id="tripKeWarning" style="color: red; display: none;">Nilai tidak boleh kurang dari 0</small>
                            </div>
                            <div>
                                <label for="jenisAPI">Jenis/Kode API<span class="required">*</span></label>
                                <input type="text" id="jenisAPI" name="jenisAPI">
                            </div>
                            <div>
                                <label for="grossTonage">Gross Tonage<span class="required">*</span></label>
                                <input type="number" id="grossTonage" name="grossTonage">
                                <small id="grossTonageWarning" style="color: red; display: none;">Nilai tidak boleh kurang dari 0</small>
                            </div>
                            <div>
                                <label for="panjangKapal">Panjang Kapal/LOA</label>
                                <input type="number" id="panjangKapal" name="panjangKapal">
                                <small id="panjangKapalWarning" style="color: red; display: none;">Nilai tidak boleh kurang dari 5</small>
                            </div>
                            <div>
                                <label for="radioPanggil">Radio Panggil</label>
                                <input type="text" id="radioPanggil" name="radioPanggil">
                            </div>
                            <div>
                                <label for="tandaPengenalKapal">Tanda Pengenal Kapal<span class="required">*</span></label>
                                <input type="text" id="tandaPengenalKapal" name="tandaPengenalKapal">
                            </div>
                            <div>
                                <label for="awakKapalWNI">Awak Kapal WNI</label>
                                <input type="number" id="awakKapalWNI" name="awakKapalWNI">
                            </div>
                            <div>
                                <label for="awakKapalWNA">Awak Kapal WNA</label>
                                <input type="number" id="awakKapalWNA" name="awakKapalWNA">
                            </div>
                            <div>
                                <label for="wppnri">WPPNRI</label>
                                <input type="number" id="wppnri" name="wppnri">
                            </div>
                            <div>
                                <label for="daerahPenangkapanIkan">Daerah Penangkapan Ikan<span class="required">*</span></label>
                                <input type="number" id="daerahPenangkapanIkan" name="daerahPenangkapanIkan">
                            </div>
                            <div>
                                <label for="pelabuhanKeberangkatan">Pelabuhan Keberangkatan<span class="required">*</span></label>
                                <select type="text" id="pelabuhanKeberangkatan" name="pelabuhanKeberangkatan">
                                    <option value="" disabled selected hidden>Pilih Pelabuhan</option>
                                    <option value="PPS Nizam Zachman">PPS Nizam Zachman</option>
                                    <option value="PU Benoa">PU Benoa</option>
                                    <option value="PPN Palabuhanratu">PPN Palabuhanratu</option>
                                    <option value="PPS Cilacap">PPS Cilacap</option>
                                    <option value="PPN Prigi">PPN Prigi</option>q
                                    <option value="PPP Pondok Dadap">PPP Pondok Dadap</option>
                                    <option value="PPP Labuhan Lombok">PPP Labuhan Lombok</option>
                                </select>
                            </div>
                            <div>
                                <label for="pelabuhanKedatangan">Pelabuhan Kedatangan<span class="required">*</span></label>
                                <select type="text" id="pelabuhanKedatangan" name="pelabuhanKedatangan">
                                    <option value="" disabled selected hidden>Pilih Pelabuhan</option>
                                    <option value="PPS Nizam Zachman">PPS Nizam Zachman</option>
                                    <option value="PU Benoa">PU Benoa</option>
                                    <option value="PPN Palabuhanratu">PPN Palabuhanratu</option>
                                    <option value="PPS Cilacap">PPS Cilacap</option>
                                    <option value="PPN Prigi">PPN Prigi</option>q
                                    <option value="PPP Pondok Dadap">PPP Pondok Dadap</option>
                                    <option value="PPP Labuhan Lombok">PPP Labuhan Lombok</option>
                                </select>
                            </div>
                            <div>
                                <label for="tanggalKeberangkatan">Tanggal Keberangkatan<span class="required">*</span></label>
                                <input type="date" id="tanggalKeberangkatan" name="tanggalKeberangkatan">
                            </div>
                            <div>
                                <label for="tanggalKedatangan">Tanggal Kedatangan<span class="required">*</span></label>
                                <input type="date" id="tanggalKedatangan" name="tanggalKedatangan">
                            </div>
                        </div>
                        <hr class="divider">
                        <h2>Posisi Aktivitas</h2>
                        <div class="bottom-container">
                            <div id="map-container"></div>
                                <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
                                <script src="js/form-map.js"></script>
                            <div class="grid-bottom">                        
                                <div>
                                    <label for="lintang">Lintang</label>
                                    <input type="text" id="lintang" name="lintang">
                                </div>
                                <div>
                                    <label for="bujur">Bujur</label>
                                    <input type="text" id="bujur" name="bujur">
                                </div>                          
                            </div>                    
                        </div>
                        <hr class="divider">
                        <h2>Komposisi Hasil Tangkapan</h2>  
                        <div class="komposisi-container">
                            <div class="komposisi-grid">
                                <label for="jenisIkan">Jenis Ikan<span class="required">*</span></label>
                                <input type="text" id="jenisIkan" name="jenisIkan">
                            </div>
                            <div class="komposisi-grid">
                                <label for="jumlahEkor">Jumlah Ekor<span class="required">*</span></label>
                                <input type="number" id="jumlahEkor" name="jumlahEkor">
                            </div>
                            <div class="komposisi-grid">
                                <label for="berat">Berat (Kg)<span class="required">*</span></label>
                                <input type="number" id="berat" name="berat">
                            </div>
                        </div>                                            

                    </div> 
                    <div class="button-container">
                        <button id="submitBtn" type="submit" class="submit-btn">Submit</button> 
                        <button id="deleteBtn" type="button"  class="delete-btn">Delete</button>                                         
                    </div>
                    <div id="serverMessage" style="color: red;"></div>
                </form>                              
            </div>                                                             
        </div>        
    </div> 
    <script>
    document.getElementById('logbookForm').addEventListener('submit', handleSubmit, { once: true });
    
    async function handleSubmit(event) {
    event.preventDefault(); 
    event.stopImmediatePropagation();

    const submitBtn = document.getElementById('submitBtn');
     submitBtn.disabled = true;

    const namaKapal = document.getElementById('namaKapal').value;
    const namaPemilik = document.getElementById('namaPemilik').value;
    const nomorPerizinan = document.getElementById('nomorPerizinan').value;
    const transmiterSPKP = document.getElementById('transmiterSPKP').value;
    const tripKe = document.getElementById('tripKe').value;
    const jenisAPI = document.getElementById('jenisAPI').value;
    const grossTonage = document.getElementById('grossTonage').value;
    const panjangKapal = document.getElementById('panjangKapal').value;
    const radioPanggil = document.getElementById('radioPanggil').value;
    const tandaPengenalKapal = document.getElementById('tandaPengenalKapal').value;
    const awakKapalWNI = document.getElementById('awakKapalWNI').value;
    const awakKapalWNA = document.getElementById('awakKapalWNA').value;
    const wppnri = document.getElementById('wppnri').value;
    const daerahPenangkapanIkan = document.getElementById('daerahPenangkapanIkan').value;
    const pelabuhanKeberangkatan = document.getElementById('pelabuhanKeberangkatan').value;
    const pelabuhanKedatangan = document.getElementById('pelabuhanKedatangan').value;
    const tanggalKeberangkatan = document.getElementById('tanggalKeberangkatan').value;
    const tanggalKedatangan = document.getElementById('tanggalKedatangan').value;
    const lintang = document.getElementById('lintang').value;
    const bujur = document.getElementById('bujur').value;
    const jenisIkan = document.getElementById('jenisIkan').value;
    const jumlahEkor = document.getElementById('jumlahEkor').value;
    const berat = document.getElementById('berat').value;    

    function showServerMessage(message, color) {
        const serverMessage = document.getElementById('serverMessage');
        if (serverMessage) {
            serverMessage.style.color = color;
            serverMessage.textContent = message;
        }
    }

    try {
        const response = await fetch('http://localhost:3000/logbook', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ namaKapal, namaPemilik, nomorPerizinan, transmiterSPKP, tripKe, 
                jenisAPI, grossTonage, panjangKapal, radioPanggil, tandaPengenalKapal, awakKapalWNI, 
                awakKapalWNA, wppnri, daerahPenangkapanIkan, pelabuhanKeberangkatan, pelabuhanKedatangan, tanggalKeberangkatan,
                tanggalKedatangan, lintang, bujur, jenisIkan, jumlahEkor, berat }),
        });

        if (response.ok) {
            showServerMessage('Data berhasil dimasukkan!', 'green');
            document.getElementById('logbookForm').reset();
          } else {
            showServerMessage('Gagal memasukkan data.', 'red');
          }
        } catch (error) {
          console.error('Error:', error);
          showServerMessage('Terjadi kesalahan server.', 'red');
        } finally {
          submitBtn.disabled = false;
        }             

}    
    </script>    
    <script src="js/search-bar.js"></script>       
</body>
</html>
